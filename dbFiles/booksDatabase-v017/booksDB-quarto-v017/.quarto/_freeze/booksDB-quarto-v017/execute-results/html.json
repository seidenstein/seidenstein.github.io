{
  "hash": "21a125d9e6d6fa284985a6f9a5e7e64d",
  "result": {
    "markdown": "---\ntitle: \"booksDB-quarto-v017\"\nexecute: \n  eval: true\n  echo: true\n  output: true\n  warning: true\n  error: true\n  include: true\nformat: \n  html:\n    toc: true\n    toc-location: left\n---\n\n\n# Practice SQL Questions (Books Database)\n\n\nContents\nOverview\t1\nDescriptions of each table\t2\nThe data\t3\nDatabase Diagrams - i.e. Entity Relationship Diagrams (ERD)\t4\nMicrosoft format\t5\n\"Crows Foot\" format\t5\nQuestions\t6\nSingle Table queries\t6\nSingle table queries with aggregate functions but no \"group by\"  (i.e. these will return EXACTLY one row for each query).\t6\nSingle table queries with calculated values\t6\nSingle table queries with \"group by\". These can use aggregate functions but will return at most one row in the output for each \"group\" of rows as \ndefined in the \"group by\"\t7\nMultiple table queries with group by\t7\nMultiple table queries\t7\nSubqueries, outer joins, unions and other stuff ...\t9\n\n\n# Overview\n\nA \"relational database\" is a collection of one or more \"tables\" that contain data about a particular topic. Each \"table\" contains rows and columns of data \n(very similar to an R dataframes). \n\nThis file contains a description of a \"relational database\" that contains information about books. The data is spread among five different tables where \neach table contains a specific subset of the data. The tables are: \"titles\", \"authors\", \"publishers\", \"royalties\" and \"title_authors\". See the following sections \nfor more information.\n\nSQL (i.e. Structured Query Language) is a standard programming language used for manipulating the contents of \"relational databases\". Using SQL \ncommands, you can retrieve data from a database in all sorts of custom arrangements (see more in the examples below). \n\nAt the end of this file are numerous questions that ask you to write SQL code to retrieve data from the books database in a very specific ways.\n\nNOTE: \nThe terminology used to describe relational databases can be confusing because different books and tutorials refer to the same concepts by different \nnames. For example, \"tables\" are sometimes alternatively called \"entities\" or \"objects\". The names of the \"columns\" in a table are sometimes referred to \nas \"fields\" or \"attributes\" of the table.\n\n\n\n\n\n\n# Descriptions of each table\n\nThe following shows the names of the tables and columns (AKA fileds) in each table.  \nFor each column, the name of the column is shown as well as the type of data in the column and a description of the data.\n\nThe actual data in the tables is shown in the next section.\n\n## authors table:   \n \nThis table stores one row for each author. \n\n \n\n\n## publishers table:  \n \nThis table stores one row for each publisher.\n\n \n\n## titles table:  \n \nThis table stores one row for each book (AKA title).\n\n \n\n## title_authors table:  \n \nEach row in this table represents a relationship between an author \nand a book that (s)he wrote. If a book has 3 authors, there will be 3 \nrows in this table for that book. This table has a composite primary \nkey (title_id, au_id). The \"royalty_share\" field represents the \npercent of the royalties that this author receives. If there is only one \nauthor for a book then this will be 1. If there are two authors for the \nbook, the \"royalty_share\" could be the same for both or it could be \ndifferent (e.g. 0.6 and 0.4).\n\n \n## royalties table:  \n \nThis table the information about royalties that the publisher will pay \nto the author(s) of a book. \"advance\" is the fixed amount that the \npublisher pays the author when (s)he starts to write the book. \n\"royalty_rate\" is a decimal value that contains the percent of each \nbook's sale price that is paid to the author(s). If there is more than \none author then the royalties and advaces are split between them\n\n \n\n\n\n\n# The data\n\n## Authors: \n \n \n\n\n## Title_Authors: \n \n  \n\n## Titles: \n\n## Royalties: \n \n \n## Publishers: \n \n \n\n\n# Database Diagrams - i.e. Entity Relationship Diagrams (ERD)\n\nThe tables in a relational database contain references to each other in the form of primary keys and foreign keys. The structure of the tables and the details of these relationships are captured in diagrams \nknown as an \"Entity Relationship Diagrams\" (or ERD) - a \"table\" is also known as an \"entity\".  Entity Relationship Diagrams come in several different formats. Some formats are more popular, some are \nless popular. Each format basically describes the same information. However, some formats include slightly more information than others.\n\nBelow are two different formats of Entity Relationship Diagrams (ERD) for the \"books database\". The 1st diagram below shows the ERD in a format that was made popular by Microsoft software. The 2nd \ndiagram below is a more popular format for ERDs. It is known as a \"crows foot diagram\". The name \"crows foot\" comes from the symbol  (which looks like the foot of a bird) which often appears on \nthis type of diagram. The crows foot diagram includes one additional piece of information that is not found on the Microsoft version.  Crows-foot notation is very popular and every symbol should be \nunderstood. See these page for more information about the crows foot notation:\nhttps://vertabelo.com/blog/crow-s-foot-notation/\nhttps://www.freecodecamp.org/news/crows-foot-notation-relationship-symbols-and-how-to-read-diagrams/\n\n \nThe Microsoft format of the diagram and the Crows foot format are only two of several different forms of \"Entity Relationship Diagrams\". There are other variations on this type of diagram. See this page \nfor an overview of various other formats for ERD's:  https://www.gleek.io/blog/er-symbols-notations\n\nEach \"box\" in a database diagram, also known as an \"Entity Relationshiop Diagram (ERD)\", represents one of the tables in the database. The name of the table appears at the top of the box.  The other \nwords in each box are the names of the columns in that table. The actual rows of data are NOT shown in the diagram.\n\nThe lines that are drawn between the tables show how the tables \"relate\" to each other.\n\n\n\n\n\n\n## Microsoft format\n\n \n\n \n \n\n## \"Crows Foot\" format\n \nThere can only be ONE primary key in a table, however, a single primary key may contain more than one field.  \nPK stands for \"primary key\". The primary key for a table that contains two or more PK fields is known as a \"composite primary key\". \n \nA table MAY contain more than one foreign key. FK1, FK2, etc. identify different foreign keys in the same table. \n \n \n\n\n# Questions\n\nCreate the following queries for the \"books\" database. For each query make sure to only include those tables that are necessary to answer the question.   NOTE: the answers shown below are just some \npossible answers. For some questions there may be more than one possible answer. \n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: sqldf\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: gsubfn\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: proto\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: RSQLite\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nAUTHORS\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n  au_id  au_fname    au_lname        phone              address          city\n1   A01     Sarah     Buchman 718-496-7223       75 West 205 St         Bronx\n2   A02     Wendy   Heydemark 303-986-7020     2922 Baseline Rd       Boulder\n3   A03    Hallie        Hull 415-549-4278 3800 Waldo Ave, #14F San Francisco\n4   A04      Klee        Hull 415-549-4278 3800 Waldo Ave, #14F San Francisco\n5   A05 Christian       Kells 212-771-4680       114 Horatio St      New York\n6   A06    Harvey     Kellsey 650-836-7128       390 Serra Mall     Palo Alto\n7   A07     Paddy O'Furniture 941-925-0752         1442 Main St      Sarasota\n  state   zip\n1    NY 10468\n2    CO 80303\n3    CA 94123\n4    CA 94123\n5    NY 10014\n6    CA 94305\n7    FL 34236\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nPUBLISHERS\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n  pub_id             pub_name          city state country\n1    P01    Abatis Publishers      New York    NY     USA\n2    P02      Core Dump Books San Francisco    CA     USA\n3    P03 Schandenfreude Press       Hamburg  <NA> Germany\n4    P04    Tneterhooks Press      Berkeley    CA     USA\n5    P05       AAA Publishing      Berkeley    CA     USA\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nTITLES\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n   title_id                          title_name       type pub_id pages price\n1       T01                               1977!    history    P01   107 21.99\n2       T02           200 Years of German Humor    history    P03    14 19.95\n3       T03        Ask Yor System Administrator   computer    P02  1226 39.95\n4       T04           But I Did It Unconciously psychology    P01   510 12.99\n5       T05              Exchange of Platitudes psychology    P01   201  6.95\n6       T06                    How About Never?  biography    P01   473 19.95\n7       T07                   I Blame My Mother  biography    P03   333 23.95\n8       T08        Just Wait Until After School   children    P01    86 10.00\n9       T09                     Kiss My Boo Boo   children    P01    22 13.95\n10      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA\n11      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99\n12      T12           Spontaneous, Not Annoying  biography    P05   507 12.99\n13      T13 What Are The Civilian Applications?    history    P03   802 29.99\n     sales         pubdate\n1      566   8/1/2000 0:00\n2     9566   4/1/1998 0:00\n3    25667   9/1/2000 0:00\n4    13001  5/31/1999 0:00\n5   201440   1/1/2001 0:00\n6    11320  7/31/2000 0:00\n7  1500200  10/1/1999 0:00\n8     4095   6/1/2001 0:00\n9     5000  5/31/2002 0:00\n10      NA            <NA>\n11   94123 11/30/2000 0:00\n12  100001  8/31/2000 0:00\n13   10467  5/31/1999 0:00\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nTITLE_AUTHORS\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n   title_id au_id au_order royalty_shares\n1       T01   A01        1            1.0\n2       T02   A01        1            1.0\n3       T03   A05        1            1.0\n4       T04   A03        1            0.6\n5       T04   A04        2            0.4\n6       T05   A04        1            1.0\n7       T06   A02        1            1.0\n8       T07   A02        1            0.5\n9       T07   A04        2            0.5\n10      T08   A06        1            1.0\n11      T09   A06        1            1.0\n12      T10   A02        1            1.0\n13      T11   A03        2            0.3\n14      T11   A04        3            0.3\n15      T11   A06        1            0.4\n16      T12   A02        1            1.0\n17      T13   A01        1            1.0\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nROYALTIES\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n   title_id advance royalty_rate\n1       T01   10000         0.05\n2       T02    1000         0.06\n3       T03   15000         0.07\n4       T04   20000         0.08\n5       T05  100000         0.09\n6       T06   20000         0.08\n7       T07 1000000         0.11\n8       T08       0         0.04\n9       T09       0         0.05\n10      T10      NA           NA\n11      T11  100000         0.07\n12      T12   50000         0.09\n13      T13   20000         0.06\n```\n:::\n:::\n\n\n\n\n\n## Single Table queries \n\n1.\tList all books (title and number sold) that sold more than 1000 copies. List the books with the most sales at the top. \n\n2.\tList all authors who are live either in NY or CA and whose last name begins with a \"K\".  \n\n3.\tList the first and last names of all authors whose last name starts with a letter from A through J   \n(HINT: In the where clause, make sure that the first letter of the last name is both  >=\"A\" and also <\"K\") \n(HINT: another possible solution is to use the LIKE several times - once for A, once for B, once for C, etc up to J. Each LIKE should be separated from the others by OR's) \n\n4.\tFor each author, show their first initial, followed by a period and a space, followed by their last name. In the 2nd column show the author's state. Show the column heading for the first column as \n'AuthorName'.  Order the results in alphabetical order based on the full name of the person. \n\n5.\tShow the titles of all books. Also show the length of the title, i.e. how many characters, including spaces and punctuation. Display the 2nd column with the name 'TitleLength'.  Sort the output so \nthat the shortest titles are listed first. If two titles are the same length then sort those titles alphabetically.  \n\n\n## Single table queries with aggregate functions but no \"group by\"  (i.e. these will return EXACTLY one row for each query).  \n\n6.\tList the average price of all books. \n\n7.\tList the average price of history books. \n\n8.\tList the number of pages in the longest and shortest books (don't list the actual title of the book). \n \n\nSingle table queries with calculated values\n\n9.\tList the title_name and total revenue for each book. (Revenue for a book is the number sold times the price of the book.) \n\n10.\tList title of each book and the sale price for the book where the sale price is 10% off of the original price. \n\n\n## Single table queries with \"group by\". These can use aggregate functions but will return at most one row in the output for each \"group\" of rows as defined in the \"group by\" \n\n11.\tFor each \"type\" of book (e.g. biography, children, etc) list the number of pages in the shortest book of that type and the number of pages in the longest book of that type. Sort the results \nalphabetically by the type of book. \n\n12.\tList the types of books (e.g. history, biography, etc) and the average price of those books for which the average price of books in that category is at least $12.00. \n\n13.\tOOPS ... this question is exactly the same as the previous question. That \n    was an oversight. Don't do this question. I left it in this document since I\n    didn't want to change the numbers of the later questions (I'll remove this\n    in a later edition of this document). \n    \n    List the types of books (e.g. history, biography, etc) and the average \n    price of those books for which the average price of books in that category \n \n\n \n\n14.\tFor each type of book (e.g. biography, children, etc), show the number of those books that are 450 pages or longer. The column heading should be '# of long books'. If there are no titles of a \nparticular type that are so long, then don't show that type at all. \n \n\t\t\n15.\tModify the answer to the previous question so that only those types for which there are at least 2 long books are displayed. \n \n\n## Multiple table queries with group by \n\n16.\tFor each publisher, list the name of the publisher and total number of pages that the publisher has published in all their books (ie. add up all the pages in all books for each publisher). Show the \npublishers who have published the most pages at the top of the result list. \n\n17.\tModify the previous query so that only publishers who have published at least 1250 pages will show up. \n \n\n18.\tList each publisher's name and the numbers of pages in their longest and shortest books. Sort the results by the publisher's name. \n \n\n## Multiple table queries \n\n19.\tList the authors first and last names, the author's state, the title name, the publisher name and the publishers state for all books. \n\n20.\tList the title, number of pages, authors first and last names and author's state for all books that are longer than 150 pages and whose author lives in NY or CA. \n\n21.\tList the authors first and last names, the author's state, the title name, the publisher name and the publishers state only for those books where the author and publisher are from the same state. \n(HINT: specify authors.state [note: there is a period between author and state] in the criteria for the publisher's state). \n\n22.\tList the title and authors of all books published by \"Abatis Publishers\" sort the results in alphabetical order by title and then by the au_order column. Do NOT show that au_order column in the \noutput. \n\n23.\tList the publisher name, author name, and title name for all books that have at least 100 pages and that sold at least 200 copies. Sort the results in alphabetical order first by publisher and then by \nauthor. \n\n24.\tList authors first and last names and the titles they wrote for publishers whose name (ie. the publisher's name) begins with \"A\", \"B\" or \"C\" \n\n25.\tList the  publisher name, author's name and phone number for all authors that have written books for the publisher's whose name begins with a letter from A through J.  (HINT: specify the \npublisher's name twice but only show one of them. In the criteria for one of them list >=\"A\" and in the criteria for the other list <\"K\"). \n\n26.\tList the titles of all books and the number of authors for the book (NOT the actual author names). Sort the results so that the books with the most authors appear on top. All books that have the \nsame number of authors should be listed in alphabetical order.\n\n27.\tList the titles of all books that have 2 or more authors and that are longer than 50 pages. \n\n28.\tList all publishers and the number of books that the publisher has published (not the actual titles, just the number of books). Sort the list so that the publisher with the most books appears on top. \n\n29.\tList the publisher name and total revenue for each for each publisher. (Total revenue for a publisher is the total revenue for all books published by that publisher. Revenue for a book is the \nnumber sold times the price of the book.)\n\n30.\tModify the previous query to only list those publishers who have at least ten thousand dollars in total revenue. \n\n31.\tList the title and author of each book. For each author for a particular book, list the amount of the \"advance\" that (s)he got for that book.\n\n32.\tList the title and author of each book. For each author for a particular book, list the total amount in royalties that (s)he got for that book.  \nHint: the royalty dollars for a particular book is the \"price\" times the \"sales\" times the \"royalty_rate\" times the \"royalty_share\". Sort the results so that the authors who made the most royalty \ndollars are listed at the top. (NOTE: make sure to read the database description at the top of this document to understand the fields ROYALTIES.ROYALTY_RATE and the field \nTITLE_AUTHORS.ROYALTY_SHARE). \n \n\n33.\tList the name of each author and the total amount of royalty dollars that they received for all of their books (name this column \"RoyaltyDollars\").  Hint: the royalty dollars for a particular book \nis the \"price\" times the \"sales\" times the \"royalty_rate\" times the \"royalty_share\". Sort the results so that the authors who made the most royalty dollars are listed at the top.  \n\n34.\tModify the query from the previous question so that the list only includes authors who made more than $50,000.00 in royalties. \n\n \n## Subqueries, outer joins, unions and other stuff ...\n\n35.\tShow the title names  and number of pages for those books that are longer than (ie.  more pages) the average length of all books. \n\n36.\tShow the publisher's name and number of authors who have written books for that publisher: \n\t\t\n37.\tShow the pub_name and the number of titles published by that publisher. Only include publishers for whom at least 5 authors have worked.  \n\n38.\tShow the names of publishers who did not publish any books (I guess they are just getting started :) ) \n\n39.\tList the name of each publisher and the total number of books that each\n    publisher has published. Sort the results so that the publishers who \n    published the most books appear at the top. If two or more publishers \n    published the same number of books then they should be listed in \n    alphabetical order. \n\n    a.  The answer should only include publisher who have published some books. \n\n    b.  This time make sure to also include publishers who have published zero books \n\n    \n## Additional questions \n\n40.\tShow the names of the authors and the publishers who published their books.  \nOnly show those authors/publishers where the author lives in the same state as the publisher who published the book. \nDo not show any author/pbulisher names twice. \n\n41.\tThe exchange rate for NIS/USD (i.e. New Israeli Shekel / US Dollar) is 3.3. \nWrite a query that shows the titles and prices for biographies that cost between 10 and 20 dollars.  \nShow two columns for the prices. One column for USD and one column for NIS.  \nName the columns \"price in USD\" and \"price in NIS\". \nSort the results so that the most expensive books are displayed first. \n\n42.\tShow those titles for which the price of the book is greater than the average price of all books and the number of pages of the book is less than the average number of pages for all books.  \n\n43.\tShow the authors who have not written any books \n\n44.\tIn each row show an author's name and the number of books that author wrote. \nOnly show those authors who wrote at least two books. \nSort the results alphabetically (last name, first name). \n\n45.\tSame as previous question. However, this time, only show those authors who wrote biographies, the count of the number of biographies they wrote and only show those authors who wrote at \nleast 2 biographies. \n\n46.\tSuppose this database is being used by a literary agent who matches up publishers and authors for future projects. \nThe agent is trying to figure out the authors he works with who might be a good match for the publishers he works with. \nThe agent thinks that authors who write books that sell for an above average price are good matches for publishers who publish books that sell for an above average price.  \nThe agent wants to see a list of the potential match-ups between such authors and such publishers. \nWrite a query that does the following: \n\tEach row of your output should show the name of an author and a publisher. \n\tThe author may have, or may not have, already written a book for that publisher. \n\tThe authors should be those authors whose average book price for books they wrote is above the average price of all books in the database. \n\tThe publishers should be those publishers whose average book price for books they published is above the average price of all books in the database. \n\n47.\tSame as above, except  \n\tThe authors should be those authors who have written at least one book for which the price is above the average price of books of the same type. \n\n\n\n",
    "supporting": [
      "booksDB-quarto-v017_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}